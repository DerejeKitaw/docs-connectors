= Salesforce CDP Connector 1.0 Examples - Mule 4

The following examples show how to do streaming and bulk operations such as upsert, query, delete, and more with the Salesforce CDP Connector:

*Streaming API Flows:* +
<<Upsert Data - Streaming API>> +
Shows how to upsert data via the streaming api to an object's endpoint.

<<Query Data>> +
Shows how to query data via the streaming api using a custom SOQL query.

<<Delete Data - Streaming API>> +
Shows how to delete records via the streaming api for specific objects.

*Bulk API Flows:* +
<<Create Job - Bulk API>> +
Shows how to create a bulk job, which is needed for uploading data to Salesforce CDP Ingestion API objects.

<<Upload Job Data - Bulk API>> +
Shows how to upload data for inserting to or deleting from a Salesforce CDP Ingestion API object.

<<Close Job - Bulk API>> +
Shows how to update the status of the specified job id so that the job is closed and queued for processing.

<<Abort Job - Bulk API>> +
Shows how to update the status of the specified job id so that the job is aborted and not queued for processing.

<<Get Job - Bulk API>> +
Shows how to retrieve current status of the specified job id.

<<Delete Job - Bulk API>> +
Shows how to delete or close the specified job id, deleting job data and metadata stored by Salesforce.

== Upsert Data - Streaming API

This Mule flow shows how to upsert data via the streaming api to an object's endpoint.
Here is what each operation is doing:

* HTTP Listener: Accepts data from HTTP PUT requests with the connector and object name as uri parameters
* Logger: Shows the HTTP request received from the Listener, then later shows the HTTP reponse from the Upsert Objects operation.
* Streaming Upsert:
+
** Authenticates based on your choice between JWT or username password.
** Receives the connector name, object name, and payload from before.
** Calls the Salesforce API to upsert the payload to that object's endpoint.

image::upsert-flow.png[]

=== XML for this example

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:sdc="http://www.mulesoft.org/schema/mule/sdc" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	  xmlns="http://www.mulesoft.org/schema/mule/core"
	  xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sdc http://www.mulesoft.org/schema/mule/sdc/current/mule-sdc.xsd">
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="73958bf0-0d4b-41bb-9628-904ad234ab83" >
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
    <configuration-properties doc:name="Configuration properties" doc:id="5be8f024-2cd5-44ba-ab5d-83fb70236381" file="mule-app.properties" />
    <sdc:sdc-config name="Salesforce_CDP_OAuth_JWT_config" doc:name="Salesforce CDP config" doc:id="db8d8261-133b-44a3-908c-90d4b977687c" >
		<sdc:oauth-jwt-connection consumerKey="${server.consumerKey}" keyStorePath="${server.keyStorePath}" storePassword="${server.keyStorePassword}" subject="${server.userName}" keyAlias="${server.certificateAlias}" audienceUrl="${server.audienceUrl}"/>
	</sdc:sdc-config>
	<sdc:sdc-config name="Salesforce_CDP_OAuth_UsernamePassword_config" doc:name="Salesforce CDP config" doc:id="d54deb47-5647-44c4-b7c8-19b49b77a4a5" >
		<sdc:oauth-user-pass-connection audienceUrl="${server.audienceUrl}" username="${server.userName}" password="${server.password}" clientId="${server.consumerKey}" clientSecret="${server.consumerSecret}"/>
	</sdc:sdc-config>

	<flow name="upsert-objectsFlow" doc:id="936990c5-feaa-4bb6-9fb6-b2d54cebbaf9" >
		<http:listener doc:name="PUT /upsert/{connectorName}/{objectName}" doc:id="3517489a-d86b-41a5-9718-ab1ff325ba57" config-ref="HTTP_Listener_config" path="/upsert/{connectorName}/{objectName}" allowedMethods="PUT"/>
		<logger level="INFO" doc:name="Request Logger" doc:id="724765c1-69fe-4c46-9a72-fd8d65a122b9" message="#[payload]"/>
		<sdc:upsert-objects doc:name="Streaming Upsert" doc:id="3aed0f42-09e7-4686-8593-053f573f5e1c" config-ref="Salesforce_CDP_OAuth_JWT_config" connectorNameUriParam="#[attributes.uriParams.connectorName]" objectNameUriParam="#[attributes.uriParams.objectName]"/>
		<logger level="INFO" doc:name="Response Logger" doc:id="537b9b1c-5dad-4d39-bce4-287735bed853" />
	</flow>
</mule>
----

=== Steps for running this example

// Add these steps to the end of the numbered list:
. Make sure your connector is already configured.
. Save the project.
. Test the flow by sending a `PUT` to `localhost:8081/{CONNECTOR_NAME}/{OBJECT_NAME}` with a JSON payload matching.
your object's schema, for example:
[source,json,linenums]
----
{
    "data": [
        {
            "your_object_field_1": "value_1",
            "your_object_field_2": "value_2",
            "your_object_field_3": "value_3"
        }
    ]
}
----

== Query Data

This Mule flow shows how to query data from CDP using a custom SOQL query.
Here is what each operation is doing:

* HTTP Listener: Accepts data from HTTP POST requests with the query in the payload.
* Logger: Shows the HTTP request received from the Listener, then later shows the HTTP reponse from the Query operation.
* Query:
+
** Authenticates based on your choice between JWT or username password.
** Receives the SOQL query from before.
** Calls the Salesforce API with the query and receives the result.

image::query-flow.png[]

=== XML for this example

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:sdc="http://www.mulesoft.org/schema/mule/sdc" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	  xmlns="http://www.mulesoft.org/schema/mule/core"
	  xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sdc http://www.mulesoft.org/schema/mule/sdc/current/mule-sdc.xsd">
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="73958bf0-0d4b-41bb-9628-904ad234ab83" >
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
    <configuration-properties doc:name="Configuration properties" doc:id="5be8f024-2cd5-44ba-ab5d-83fb70236381" file="mule-app.properties" />
    <sdc:sdc-config name="Salesforce_CDP_OAuth_JWT_config" doc:name="Salesforce CDP config" doc:id="db8d8261-133b-44a3-908c-90d4b977687c" >
		<sdc:oauth-jwt-connection consumerKey="${server.consumerKey}" keyStorePath="${server.keyStorePath}" storePassword="${server.keyStorePassword}" subject="${server.userName}" keyAlias="${server.certificateAlias}" audienceUrl="${server.audienceUrl}"/>
	</sdc:sdc-config>
	<sdc:sdc-config name="Salesforce_CDP_OAuth_UsernamePassword_config" doc:name="Salesforce CDP config" doc:id="d54deb47-5647-44c4-b7c8-19b49b77a4a5" >
		<sdc:oauth-user-pass-connection audienceUrl="${server.audienceUrl}" username="${server.userName}" password="${server.password}" clientId="${server.consumerKey}" clientSecret="${server.consumerSecret}"/>
	</sdc:sdc-config>

	<flow name="query-objectsFlow" doc:id="973eb1df-5995-4d2f-a98e-ecb255bc36ac" >
		<http:listener doc:name="POST /query" doc:id="cc7e468d-ea29-4c81-b7d9-2d775a559413" config-ref="HTTP_Listener_config" path="/query" allowedMethods="POST"/>
		<logger level="INFO" doc:name="Request Logger" doc:id="ad692812-0267-4c5d-b1be-7ba121980ef8" message="#[payload]"/>
		<sdc:query doc:name="Query" doc:id="9248651a-fb67-40a4-a5f3-c4b2017c072b" config-ref="Salesforce_CDP_OAuth_JWT_config"/>
		<logger level="INFO" doc:name="Response Logger" doc:id="e7f675d9-113b-4ea8-929b-ed0b66fba977" message="#[payload]"/>
	</flow>
</mule>
----

=== Steps for running this example

// Add these steps to the end of the numbered list:
. Make sure your connector is already configured.
. Save the project.
. Test the flow by sending a `POST` to `localhost:8081/query` with SOQL query in the request body, for example:
[source,json,linenums]
----
{
    "sql": "SELECT ID FROM ACCOUNT LIMIT 1"
}
----

== Delete Data - Streaming API

This Mule flow shows how to delete data via the streaming api using an object's endpoint.
Here is what each operation is doing:

* HTTP Listener: Accepts data from HTTP DELETE requests with the connector and object name as uri parameters and record ids as query parameters.
* Logger: Shows the HTTP request received from the Listener, then later shows the HTTP reponse from the Streaming Delete operation.
* Streaming Delete:
+
** Authenticates based on your choice between JWT or username password.
** Receives the connector name, object name, and record ids from before.
** Calls the Salesforce API to delete the records from the query params using that object's endpoint.

image::delete-flow.png[]

=== XML for this example

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:sdc="http://www.mulesoft.org/schema/mule/sdc" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	  xmlns="http://www.mulesoft.org/schema/mule/core"
	  xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sdc http://www.mulesoft.org/schema/mule/sdc/current/mule-sdc.xsd">
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="73958bf0-0d4b-41bb-9628-904ad234ab83" >
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
    <configuration-properties doc:name="Configuration properties" doc:id="5be8f024-2cd5-44ba-ab5d-83fb70236381" file="mule-app.properties" />
    <sdc:sdc-config name="Salesforce_CDP_OAuth_JWT_config" doc:name="Salesforce CDP config" doc:id="db8d8261-133b-44a3-908c-90d4b977687c" >
		<sdc:oauth-jwt-connection consumerKey="${server.consumerKey}" keyStorePath="${server.keyStorePath}" storePassword="${server.keyStorePassword}" subject="${server.userName}" keyAlias="${server.certificateAlias}" audienceUrl="${server.audienceUrl}"/>
	</sdc:sdc-config>
	<sdc:sdc-config name="Salesforce_CDP_OAuth_UsernamePassword_config" doc:name="Salesforce CDP config" doc:id="d54deb47-5647-44c4-b7c8-19b49b77a4a5" >
		<sdc:oauth-user-pass-connection audienceUrl="${server.audienceUrl}" username="${server.userName}" password="${server.password}" clientId="${server.consumerKey}" clientSecret="${server.consumerSecret}"/>
	</sdc:sdc-config>

	<flow name="delete-objectsFlow" doc:id="6610faf2-e073-4329-8683-44b1dfe4c417" >
		<http:listener doc:name="DELETE /delete/{connectorName}/{objectName}" doc:id="e4e9f2ee-b663-4346-9ad8-7a85b363a705" config-ref="HTTP_Listener_config" path="/delete/{connectorName}/{objectName}" allowedMethods="DELETE"/>
		<logger level="INFO" doc:name="Request Logger" doc:id="bfb377f8-bd95-4b97-a5e6-d6acc22a1cbc" />
		<sdc:delete-objects doc:name="Streaming Delete" doc:id="e3f83699-36d2-401d-bc8d-32df5b1b44ca" config-ref="Salesforce_CDP_OAuth_JWT_config" idsQueryParams="#[output application/java&#10;---&#10;[attributes.queryParams.ids]]" connectorNameUriParam="#[attributes.uriParams.connectorName]" objectNameUriParam="#[attributes.uriParams.objectName]"/>
		<logger level="INFO" doc:name="Response Logger" doc:id="148364d5-413c-4427-806f-5a1407ce4955" />
	</flow>
</mule>
----

=== Steps for running this example

. Make sure your connector is already configured
. Save the project.
. Test the flow by sending a `DELETE` to
`localhost:8081/delete/{CONNECTOR_NAME}/{OBJECT_NAME}?ids={RECORD_NUMBER},{RECORD_NUMBER}`. For example:
[source,json,linenums]
----
localhost:8081/delete/My_Connector/My_Object?ids=1,2,3
----

== Create Job - Bulk API

This Mule flow shows how to create a bulk job. A bulk job is needed for uploading data to a Salesforce CDP Ingestion API object.
Here is what each operation is doing:

* HTTP Listener: Accepts data from HTTP POST requests with the connector and object name as uri parameters and record ids as query parameters.
* Logger: Shows the HTTP request received from the Listener, then later shows the HTTP reponse from the Create Job operation.
* Create Job:
+
** Authenticates based on your choice between JWT or username password.
** Receives the connector name, object name, and job operation from before. Job operations can be found in the Resources page.
** Calls the Salesforce API to create the job, and returns the response.

image::create-job-bulk.png[]

=== XML for this example

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:salesforce="http://www.mulesoft.org/schema/mule/salesforce" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:file="http://www.mulesoft.org/schema/mule/file"
	xmlns:sdc="http://www.mulesoft.org/schema/mule/sdc" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sdc http://www.mulesoft.org/schema/mule/sdc/current/mule-sdc.xsd
http://www.mulesoft.org/schema/mule/file http://www.mulesoft.org/schema/mule/file/current/mule-file.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/salesforce http://www.mulesoft.org/schema/mule/salesforce/current/mule-salesforce.xsd">
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="886b5611-c05c-446e-ae76-39df4e2bb21e" >
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<sdc:sdc-config name="Salesforce_CDP_OAuth_JWT_config" doc:name="Salesforce CDP config" doc:id="cf40ffe6-9171-4ce4-860f-2a0dfadd5f33" >
		<sdc:oauth-jwt-connection consumerKey="${server.consumerKey}" keyStorePath="${server.keyStorePath}" storePassword="${server.keyStorePassword}" subject="${server.userName}" audienceUrl="${server.audienceUrl}" keyAlias="${server.certificateAlias}" />
	</sdc:sdc-config>
	<configuration-properties doc:name="Configuration properties" doc:id="b7a2e541-8a53-4a69-9cca-785eb6645034" file="mule-app.properties" />
	<sdc:sdc-config name="Salesforce_CDP_OAuth_UsernamePassword_config" doc:name="Salesforce CDP config" doc:id="997ee207-70f5-4c94-aa99-b602ae75bb98" >
		<sdc:oauth-user-pass-connection clientId="${server.consumerKey}" clientSecret="${server.consumerSecret}" username="${server.userName}" password="${server.password}" audienceUrl="${server.audienceUrl}" />
	</sdc:sdc-config>
	<flow name="CreateJob" doc:id="84ee94c3-1baa-46b0-85c1-ec59b973b2a4" >
		<http:listener doc:name="Post /jobs/create" doc:id="aee7f51e-21b6-43af-a928-38d4f9f4d0a3" config-ref="HTTP_Listener_config" path="/jobs/create/{connectorName}/{objectName}/{operation}"/>
		<sdc:create-bulk-job doc:name="Create Job" doc:id="20d19d4a-90c9-45fc-9c4f-77c7e942f451" config-ref="Salesforce_CDP_OAuth_UsernamePassword_config" connectorNameUriParam="#[attributes.uriParams.connectorName]" objectNameUriParam="#[attributes.uriParams.objectName]" operationUriParam="#[attributes.uriParams.operation]"/>
		<logger level="INFO" doc:name="Logger" doc:id="62648d34-3d6a-46d4-b72c-8934463d9da1" />
	</flow>
</mule>

----

=== Steps for running this example

. Make sure your connector is already configured
. Save the project.
. Test the flow by sending a `POST` to
`localhost:8081/jobs/create/{CONNECTOR_NAME}/{OBJECT_NAME}/{OPERATION}`

== Upload Job Data - Bulk API

This Mule flow shows how to upload data for inserting to or deleting from a Salesforce CDP Ingestion API object specified by the job id.
Here is what each operation is doing:

* HTTP Listener: Accepts data from HTTP POST requests with job id in the uri.
* CSV Reader: Reads data from the csv absolute file path configured in it.
* Set Payload: Updates the payload with the csv data for Upload Job Data
* Upload Job Data:
+
** Authenticates based on your choice between JWT or username password.
** Receives the job id from the HTTP request and csv data that's now in the payload.
** Uploads data from the csv to the Salesforce CDP Ingestion API object, eventually returning an HTTP response.
* Logger: Shows the HTTP result from the Upload Job Data operation.

image::upload-job-data-bulk.png[]

=== XML for this example

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:salesforce="http://www.mulesoft.org/schema/mule/salesforce" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:file="http://www.mulesoft.org/schema/mule/file"
	xmlns:sdc="http://www.mulesoft.org/schema/mule/sdc" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sdc http://www.mulesoft.org/schema/mule/sdc/current/mule-sdc.xsd
http://www.mulesoft.org/schema/mule/file http://www.mulesoft.org/schema/mule/file/current/mule-file.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/salesforce http://www.mulesoft.org/schema/mule/salesforce/current/mule-salesforce.xsd">
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="886b5611-c05c-446e-ae76-39df4e2bb21e" >
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<sdc:sdc-config name="Salesforce_CDP_OAuth_JWT_config" doc:name="Salesforce CDP config" doc:id="cf40ffe6-9171-4ce4-860f-2a0dfadd5f33" >
		<sdc:oauth-jwt-connection consumerKey="${server.consumerKey}" keyStorePath="${server.keyStorePath}" storePassword="${server.keyStorePassword}" subject="${server.userName}" audienceUrl="${server.audienceUrl}" keyAlias="${server.certificateAlias}" />
	</sdc:sdc-config>
	<configuration-properties doc:name="Configuration properties" doc:id="b7a2e541-8a53-4a69-9cca-785eb6645034" file="mule-app.properties" />
	<sdc:sdc-config name="Salesforce_CDP_OAuth_UsernamePassword_config" doc:name="Salesforce CDP config" doc:id="997ee207-70f5-4c94-aa99-b602ae75bb98" >
		<sdc:oauth-user-pass-connection clientId="${server.consumerKey}" clientSecret="${server.consumerSecret}" username="${server.userName}" password="${server.password}" audienceUrl="${server.audienceUrl}" />
	</sdc:sdc-config>
	<flow name="UploadJobData" doc:id="a6149628-b8f5-4bb1-bff4-620f8915a1e5" >
        <http:listener doc:name="Upload Job Data Listener" doc:id="41d86e51-7b88-4c55-8dfa-0aca3451c95e" config-ref="HTTP_Listener_config" path="/jobs/upload/{jobId}"/>
        <file:read doc:name="CSV Reader" doc:id="4b65bab3-b46e-473d-98e0-6c0ad59b55a0" path="" target="content"/>
        <set-payload value="#[vars.content]" doc:name="Set Payload" doc:id="dec290fe-af6e-44a9-9946-2cff0af0dbee" />
        <sdc:ingest-request-batch-payload doc:name="Upload Job Data" doc:id="a74a86b9-465e-48c0-a0db-68756ac2b2e2" config-ref="Salesforce_CDP_OAuth_JWT_config" idUriParam="#[attributes.uriParams.jobId]"/>
        <logger level="INFO" doc:name="Logger" doc:id="1927473c-e8cb-49fe-8548-83a7c3045aa1" message="#[message]"/>
    </flow>
</mule>
----

=== Steps for running this example

. Make sure your connector is already configured
. Enter a valid absolute file path to a csv in the CSV Reader's "File Path" attribute.
. Save the project.
. Create a job and copy its job id.
. Test the flow by sending a `POST` to
`localhost:8081/jobs/upload/{JOB_ID}` using the previous job id.

== Close Job - Bulk API

This Mule flow shows how to update the status of the specified job id, so the job is closed.
After a job is closed, it will be queued for processing.

* HTTP Listener: Accepts data from HTTP GET requests with the job id as an uri parameter.
* Logger: Shows the HTTP response from the Close Job operation.
* Close Job:
+
** Authenticates based on your choice between JWT or username password.
** Receives the job id from before.
** Calls the Salesforce API to with the UploadComplete state, completing that job. It then receives an HTTP response.

image::close-job-bulk.png[]

=== XML for this example

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:salesforce="http://www.mulesoft.org/schema/mule/salesforce" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:file="http://www.mulesoft.org/schema/mule/file"
	xmlns:sdc="http://www.mulesoft.org/schema/mule/sdc" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sdc http://www.mulesoft.org/schema/mule/sdc/current/mule-sdc.xsd
http://www.mulesoft.org/schema/mule/file http://www.mulesoft.org/schema/mule/file/current/mule-file.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/salesforce http://www.mulesoft.org/schema/mule/salesforce/current/mule-salesforce.xsd">
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="886b5611-c05c-446e-ae76-39df4e2bb21e" >
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<sdc:sdc-config name="Salesforce_CDP_OAuth_JWT_config" doc:name="Salesforce CDP config" doc:id="cf40ffe6-9171-4ce4-860f-2a0dfadd5f33" >
		<sdc:oauth-jwt-connection consumerKey="${server.consumerKey}" keyStorePath="${server.keyStorePath}" storePassword="${server.keyStorePassword}" subject="${server.userName}" audienceUrl="${server.audienceUrl}" keyAlias="${server.certificateAlias}" />
	</sdc:sdc-config>
	<configuration-properties doc:name="Configuration properties" doc:id="b7a2e541-8a53-4a69-9cca-785eb6645034" file="mule-app.properties" />
	<sdc:sdc-config name="Salesforce_CDP_OAuth_UsernamePassword_config" doc:name="Salesforce CDP config" doc:id="997ee207-70f5-4c94-aa99-b602ae75bb98" >
		<sdc:oauth-user-pass-connection clientId="${server.consumerKey}" clientSecret="${server.consumerSecret}" username="${server.userName}" password="${server.password}" audienceUrl="${server.audienceUrl}" />
	</sdc:sdc-config>
	<flow name="CloseJob" doc:id="03155c91-af6a-482f-8122-de6b388c4cb7" >
		<http:listener doc:name="Get /jobs/close/{jobId}" doc:id="71598457-eed5-4255-8446-632696eaa7f9" config-ref="HTTP_Listener_config" path="/jobs/close/{jobId}"/>
		<sdc:update-bulk-operation-job doc:name="Close Job" doc:id="3520ace6-5cdb-4923-b430-ca411886deba" config-ref="Salesforce_CDP_OAuth_JWT_config" idUriParam="#[attributes.uriParams.jobId]" state="UploadComplete"/>
		<logger level="INFO" doc:name="Logger" doc:id="cfe8e4be-6e18-4a3e-881a-1bc70e79036c" />
	</flow>
</mule>

----

=== Steps for running this example

. Make sure your connector is already configured
. Save the project.
. Create a job and copy the resulting job id.
. Test the flow by sending a `GET` to
`localhost:8081/jobs/close/{JOB_ID}` with the job id from before.

== Abort Job - Bulk API

This Mule flow shows how to update the status of the specified job id, so that the job is aborted.
After a job is aborted, it will not be queued for processing.

* HTTP Listener: Accepts data from HTTP GET requests with the job id as an uri parameter.
* Logger: Shows the HTTP response from the Abort Job operation.
* Abort Job:
+
** Authenticates based on your choice between JWT or username password.
** Receives the job id from before.
** Calls the Salesforce API to with the Aborted state, aborting that job. It then receives an HTTP response.

image::abort-job-bulk.png[]

=== XML for this example

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:salesforce="http://www.mulesoft.org/schema/mule/salesforce" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:file="http://www.mulesoft.org/schema/mule/file"
	xmlns:sdc="http://www.mulesoft.org/schema/mule/sdc" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sdc http://www.mulesoft.org/schema/mule/sdc/current/mule-sdc.xsd
http://www.mulesoft.org/schema/mule/file http://www.mulesoft.org/schema/mule/file/current/mule-file.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/salesforce http://www.mulesoft.org/schema/mule/salesforce/current/mule-salesforce.xsd">
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="886b5611-c05c-446e-ae76-39df4e2bb21e" >
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<sdc:sdc-config name="Salesforce_CDP_OAuth_JWT_config" doc:name="Salesforce CDP config" doc:id="cf40ffe6-9171-4ce4-860f-2a0dfadd5f33" >
		<sdc:oauth-jwt-connection consumerKey="${server.consumerKey}" keyStorePath="${server.keyStorePath}" storePassword="${server.keyStorePassword}" subject="${server.userName}" audienceUrl="${server.audienceUrl}" keyAlias="${server.certificateAlias}" />
	</sdc:sdc-config>
	<configuration-properties doc:name="Configuration properties" doc:id="b7a2e541-8a53-4a69-9cca-785eb6645034" file="mule-app.properties" />
	<sdc:sdc-config name="Salesforce_CDP_OAuth_UsernamePassword_config" doc:name="Salesforce CDP config" doc:id="997ee207-70f5-4c94-aa99-b602ae75bb98" >
		<sdc:oauth-user-pass-connection clientId="${server.consumerKey}" clientSecret="${server.consumerSecret}" username="${server.userName}" password="${server.password}" audienceUrl="${server.audienceUrl}" />
	</sdc:sdc-config>
	<flow name="AbortJob" doc:id="6b5f4285-b450-4d1f-ae64-852802e177da" >
		<http:listener doc:name="Get /jobs/abort/{jobId}" doc:id="af61875d-95b2-4c5e-9e5d-6a2bec7cb03d" config-ref="HTTP_Listener_config" path="/jobs/abort/{jobId}"/>
		<sdc:update-bulk-operation-job doc:name="Abort Job" doc:id="d62f4577-92ea-492a-90b7-b31f5b39ff5a" config-ref="Salesforce_CDP_OAuth_JWT_config" idUriParam="#[attributes.uriParams.jobId]" state="Aborted"/>
		<logger level="INFO" doc:name="Logger" doc:id="5af236e9-d809-4eb4-9e7a-1cd73074a773" />
	</flow>
</mule>

----

=== Steps for running this example

. Make sure your connector is already configured
. Save the project.
. Create a job and copy the resulting job id.
. Test the flow by sending a `GET` to
`localhost:8081/jobs/abort/{JOB_ID}` with the job id from before.

== Get Job - Bulk API

This Mule flow shows how to retrieve current status of the specified job id.
Here is what each operation is doing:

* HTTP Listener: Accepts data from HTTP GET requests with the job id in the uri parameters.
* Logger: Shows the HTTP response from the Get Job operation.
* Get Job:
+
** Authenticates based on your choice between JWT or username password.
** Receives the job id from before.
** Calls the Salesforce API and returns the job status.

image::get-job-bulk.png[]

=== XML for this example

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:salesforce="http://www.mulesoft.org/schema/mule/salesforce" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:file="http://www.mulesoft.org/schema/mule/file"
	xmlns:sdc="http://www.mulesoft.org/schema/mule/sdc" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sdc http://www.mulesoft.org/schema/mule/sdc/current/mule-sdc.xsd
http://www.mulesoft.org/schema/mule/file http://www.mulesoft.org/schema/mule/file/current/mule-file.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/salesforce http://www.mulesoft.org/schema/mule/salesforce/current/mule-salesforce.xsd">
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="886b5611-c05c-446e-ae76-39df4e2bb21e" >
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<sdc:sdc-config name="Salesforce_CDP_OAuth_JWT_config" doc:name="Salesforce CDP config" doc:id="cf40ffe6-9171-4ce4-860f-2a0dfadd5f33" >
		<sdc:oauth-jwt-connection consumerKey="${server.consumerKey}" keyStorePath="${server.keyStorePath}" storePassword="${server.keyStorePassword}" subject="${server.userName}" audienceUrl="${server.audienceUrl}" keyAlias="${server.certificateAlias}" />
	</sdc:sdc-config>
	<configuration-properties doc:name="Configuration properties" doc:id="b7a2e541-8a53-4a69-9cca-785eb6645034" file="mule-app.properties" />
	<sdc:sdc-config name="Salesforce_CDP_OAuth_UsernamePassword_config" doc:name="Salesforce CDP config" doc:id="997ee207-70f5-4c94-aa99-b602ae75bb98" >
		<sdc:oauth-user-pass-connection clientId="${server.consumerKey}" clientSecret="${server.consumerSecret}" username="${server.userName}" password="${server.password}" audienceUrl="${server.audienceUrl}" />
	</sdc:sdc-config>
	<flow name="GetJob" doc:id="2d427d44-0c35-4c23-8262-aace51595d05" >
		<http:listener doc:name="Get /jobs/get/{jobId}" doc:id="9b496128-1c99-4a94-a0d6-3ea10daee903" config-ref="HTTP_Listener_config" path="/jobs/get/{jobId}"/>
		<sdc:get-bulk-job doc:name="Get Job" doc:id="9c5e76a9-696c-45f0-9a8b-0e8863ca7c27" config-ref="Salesforce_CDP_OAuth_JWT_config" idUriParam="#[attributes.uriParams.jobId]"/>
		<logger level="INFO" doc:name="Logger" doc:id="269cd3b5-14b0-43ea-9b18-4215433de1e8" />
	</flow>
</mule>
----

=== Steps for running this example

. Make sure your connector is already configured
. Save the project.
. Create a job and copy the resulting job id.
. Test the flow by sending a `GET` to
`localhost:8081/jobs/get/{JOB_ID}` with the previous job id.

== Delete Job - Bulk API

This Mule flow shows how to delete or close the specified job id, deleting job data and metadata stored by Salesforce.
To be deleted, a job must have a state of UploadComplete, JobComplete, Aborted, or Failed. +

Here is what each operation is doing:

* HTTP Listener: Accepts data from HTTP DELETE requests with the job id in the uri parameters.
* Logger: Shows the HTTP response from the Delete Job operation.
* Delete Job:
+
** Authenticates based on your choice between JWT or username password.
** Receives the job id from before.
** Calls the Salesforce API and deletes the job.

image::delete-job-bulk.png[]

=== XML for this example

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:salesforce="http://www.mulesoft.org/schema/mule/salesforce" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:file="http://www.mulesoft.org/schema/mule/file"
	xmlns:sdc="http://www.mulesoft.org/schema/mule/sdc" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sdc http://www.mulesoft.org/schema/mule/sdc/current/mule-sdc.xsd
http://www.mulesoft.org/schema/mule/file http://www.mulesoft.org/schema/mule/file/current/mule-file.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/salesforce http://www.mulesoft.org/schema/mule/salesforce/current/mule-salesforce.xsd">
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="886b5611-c05c-446e-ae76-39df4e2bb21e" >
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<sdc:sdc-config name="Salesforce_CDP_OAuth_JWT_config" doc:name="Salesforce CDP config" doc:id="cf40ffe6-9171-4ce4-860f-2a0dfadd5f33" >
		<sdc:oauth-jwt-connection consumerKey="${server.consumerKey}" keyStorePath="${server.keyStorePath}" storePassword="${server.keyStorePassword}" subject="${server.userName}" audienceUrl="${server.audienceUrl}" keyAlias="${server.certificateAlias}" />
	</sdc:sdc-config>
	<configuration-properties doc:name="Configuration properties" doc:id="b7a2e541-8a53-4a69-9cca-785eb6645034" file="mule-app.properties" />
	<sdc:sdc-config name="Salesforce_CDP_OAuth_UsernamePassword_config" doc:name="Salesforce CDP config" doc:id="997ee207-70f5-4c94-aa99-b602ae75bb98" >
		<sdc:oauth-user-pass-connection clientId="${server.consumerKey}" clientSecret="${server.consumerSecret}" username="${server.userName}" password="${server.password}" audienceUrl="${server.audienceUrl}" />
	</sdc:sdc-config>
	<flow name="DeleteJob" doc:id="921e73e4-5928-4a7b-9461-7d447ecfa15d" >
		<http:listener doc:name="Delete /jobs/delete/{jobId}" doc:id="2c514d93-8fbf-4343-adda-7fe836492a04" config-ref="HTTP_Listener_config" path="/jobs/delete/{jobId}"/>
		<sdc:delete-bulk-job doc:name="Delete Job" doc:id="9ac17157-c336-4a3e-a020-8eb5fba3f885" config-ref="Salesforce_CDP_OAuth_JWT_config" idUriParam="#[attributes.uriParams.jobId]"/>
		<logger level="INFO" doc:name="Logger" doc:id="1c4f1a01-77b3-419f-81e4-4c7baa5f762e" />
	</flow>
</mule>

----

=== Steps for running this example

. Make sure your connector is already configured
. Save the project.
. Create a job and copy the resulting job id.
. Use that job id to close the job (see <<Close Job - Bulk API>> flow).
. Test the flow by sending a `DELETE` to
`localhost:8081/jobs/delete/{JOB_ID}` with the previous job id.

== See Also

* xref:connectors::introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* https://help.mulesoft.com[MuleSoft Help Center]
