= MQTT3 Connector Troubleshooting

Here's a few tips you can implement if you're having trouble setting up your MQTT application.

== Enable Connector's Verbose Logging

To enable verbose logging on the connector's side, you need to activate logging for the connector and for the Eclipse Paho driver.

=== Enable Connector's Verbose Logging

To enable MQTT3 Connector's TRACE level logging simply add the following line to your application's log4j2 file.

`<AsyncLogger name="com.mulesoft.connectors.mqtt3" level="TRACE"/>`

=== Enable Eclipse Paho's Verbose Logging

Because Eclipse Paho, the underlying driver for the MQTT3 Connector, uses Java Util Logging, you will need to follow a special set of steps
if you want to see the driver's log messages in our application's log file.

This article will show you how to provide your application with the latest log4j-jul-2.xx.x.jar version: https://help.mulesoft.com/s/article/Use-Apache-log4j-JUL-Adapter-to-Integrate-java-util-logging-Logger-With-log4j2-xml-Logging-Level-Settings-in-On-Premises-Mule-4-App

Follow the steps, and in step 4, use the following element to set the desired configuration level:

`<AsyncLogger name="org.eclipse.paho.client.mqttv3.logging.JSR47Logger" level="ALL"/>`

Bare in mind that, for the `level` attribute, you will need to provide a Java Util Logging Level. A conversion table of Java Util Logging levels and its equivalent Log4j levels is provided here: https://logging.apache.org/log4j/log4j-2.3/log4j-jul/index.html

== Enable Mosquitto Broker's Verbose Logging

Each broker has different mechanisms to configure logging, in this section we will do a quick review of how you can set up
a mosquitto broker and configure logging levels.

To set up a mosquitto broker, you can use the official docker image as:

`docker run -it -p 1883:1883 \
            -v /your/local/path/mosquitto.log:/mosquitto/mosquitto.log \
            -v /your/local/path/mosquitto.conf:/mosquitto/config/mosquitto.conf eclipse-mosquitto`

By using this command, you are supplying a log file `mosquitto.log` and a configuration file `mosquitto.conf`.

The `mosquitto.log` is simply a file for the broker to write log messages to.

The `mosquitto.conf` is the broker configuration file. Here we can set the desired log level, for example:

[source,text,linenums]
----
# Unencrypted MQTT over TCP
# for listener at port 1883
listener 1883
allow_anonymous true

# =================================================================
# Logging
# =================================================================

# Route log messages to log file
log_dest file /mosquitto/mosquitto.log

# Types of messages to log. Use multiple log_type lines for logging
# multiple types of messages.
log_type debug
log_type error
log_type warning
log_type notice
log_type information
----

