= MQTT3 Connector Connector Reference - Mule 4
:page-aliases: connectors::amqp/mqtt3-documentation.adoc

= MQTT3 Connector Connector Reference


MQTT3 is a MQTT v3 compliant MuleSoft Extension, used to consume and produce MQTT Messages. The Extension supports all MQTT v3 functionality including message retention, last will and testament messages and persistent sessions.


== Configurations
---
[[Config]]
=== Config


Default configuration


==== Parameters

[%header%autowidth.spread]
|===
| Name | Type | Description | Default Value | Required
|Name | String | The name for this configuration. Connectors reference the configuration with this name. | | *x*{nbsp}
| Connection a| * <<Config_Connection, MQTT3 URL Connection>> {nbsp}
* <<Config_FailOver, MQTT3 Fail-Over Connection>> {nbsp}
* <<Config_Form, MQTT3 Form Connection>> {nbsp}
 | The connection types that can be provided to this configuration. | | *x*{nbsp}
| Name a| String |  The identifier of this element used to reference it in other components |  | *x*{nbsp}
| Expiration Policy a| <<ExpirationPolicy>> |  Configures the minimum amount of time that a dynamic configuration instance can remain idle before the runtime considers it eligible for expiration. This does not mean that the platform will expire the instance at the exact moment that it becomes eligible. The runtime will actually purge the instances when it sees it fit. |  | {nbsp}
|===

==== Connection Types
[[Config_Connection]]
===== MQTT3 URL Connection


Cached Connection provider that creates MQTT Connections. Allows the user to specify a connection URL for the broker.


====== Parameters

[%header%autowidth.spread]
|===
| Name | Type | Description | Default Value | Required
| Client ID a| String |  Client id to be used to identify the connection to the MQTT broker. |  | *x*{nbsp}
| Username a| String |  Username to be used when providing authentication credentials to the MQTT broker. |  | {nbsp}
| Password a| String |  Password to be used when providing authentication credentials to the MQTT broker. |  | {nbsp}
| URL a| String |  The url that represents the broker to connect to. |  | *x*{nbsp}
| TLS Context a| <<Tls>> |  |  | {nbsp}
| Topic a| String |  The topic to which the last will and testament message will be published. |  | {nbsp}
| Body a| String |  The content of the last will and testament message. |  | {nbsp}
| QoS a| Enumeration, one of:

** AT_MOST_ONCE
** AT_LEAST_ONCE
** EXACTLY_ONCE |  The quality of service QoS with which the last will and testament message will be published. Defaults to AT_LEAST_ONCE |  AT_LEAST_ONCE | {nbsp}
| Is Retained a| Boolean |  If set to true the last will and testament message will be retained by the broker. |  false | {nbsp}
| Connection Timeout a| Number |  The socket connection timeout value. This attribute works in tandem with #timeoutUnit. In the case of multiple fail-over URLs provided, the timeout applies to each one individually. |  30 | {nbsp}
| Timeout Unit a| Enumeration, one of:

** NANOSECONDS
** MICROSECONDS
** MILLISECONDS
** SECONDS
** MINUTES
** HOURS
** DAYS |  A TimeUnit which qualifies the #connectionTimeout attribute. Defaults to SECONDS |  SECONDS | {nbsp}
| Keep Alive Interval a| Number |  The amount of time that the connection between client and broker will be kept alive without any messages being exchanged. If the keep-alive interval is 0, then the keep-alive mechanism is disabled. |  0 | {nbsp}
| Keep Alive Interval Unit a| Enumeration, one of:

** NANOSECONDS
** MICROSECONDS
** MILLISECONDS
** SECONDS
** MINUTES
** HOURS
** DAYS |  The unit of time that corresponds to the keepAliveInterval parameter. Defaults to SECONDS |  SECONDS | {nbsp}
| Max In Flight a| Number |  The maximum amount of messages that can be unacknowledged at a given time. Setting it to 0 means, there can be unlimited in-flight messages. |  10 | {nbsp}
| Clean Session a| Boolean |  If set to true, the session will be cleaned each time the client disconnects from the broker. Subscriptions will not be saved and offline (qos 1 and 2) messages for that client will be lost. |  true | {nbsp}
| Enable File Persistence a| Boolean |  If set to true, creates an file-based persistent data store, used to store outbound and inbound messages while they are in flight, enabling delivery to the QoS specified. |  false | {nbsp}
| Reconnection a| <<Reconnection>> |  When the application is deployed, a connectivity test is performed on all connectors. If set to true, deployment will fail if the test doesn't pass after exhausting the associated reconnection strategy |  | {nbsp}
|===
[[Config_FailOver]]
===== MQTT3 Fail-Over Connection


====== Parameters

[%header%autowidth.spread]
|===
| Name | Type | Description | Default Value | Required
| Client ID a| String |  Client id to be used to identify the connection to the MQTT broker. |  | *x*{nbsp}
| Username a| String |  Username to be used when providing authentication credentials to the MQTT broker. |  | {nbsp}
| Password a| String |  Password to be used when providing authentication credentials to the MQTT broker. |  | {nbsp}
| Fail Over Servers a| Array of <<FailOverUrl>> |  The list of server URLs that will be used to (attempt to) establish a connection to the broker. |  | *x*{nbsp}
| TLS Context a| <<Tls>> |  |  | {nbsp}
| Topic a| String |  The topic to which the last will and testament message will be published. |  | {nbsp}
| Body a| String |  The content of the last will and testament message. |  | {nbsp}
| QoS a| Enumeration, one of:

** AT_MOST_ONCE
** AT_LEAST_ONCE
** EXACTLY_ONCE |  The quality of service QoS with which the last will and testament message will be published. Defaults to AT_LEAST_ONCE |  AT_LEAST_ONCE | {nbsp}
| Is Retained a| Boolean |  If set to true the last will and testament message will be retained by the broker. |  false | {nbsp}
| Connection Timeout a| Number |  The socket connection timeout value. This attribute works in tandem with #timeoutUnit. In the case of multiple fail-over URLs provided, the timeout applies to each one individually. |  30 | {nbsp}
| Timeout Unit a| Enumeration, one of:

** NANOSECONDS
** MICROSECONDS
** MILLISECONDS
** SECONDS
** MINUTES
** HOURS
** DAYS |  A TimeUnit which qualifies the #connectionTimeout attribute. Defaults to SECONDS |  SECONDS | {nbsp}
| Keep Alive Interval a| Number |  The amount of time that the connection between client and broker will be kept alive without any messages being exchanged. If the keep-alive interval is 0, then the keep-alive mechanism is disabled. |  0 | {nbsp}
| Keep Alive Interval Unit a| Enumeration, one of:

** NANOSECONDS
** MICROSECONDS
** MILLISECONDS
** SECONDS
** MINUTES
** HOURS
** DAYS |  The unit of time that corresponds to the keepAliveInterval parameter. Defaults to SECONDS |  SECONDS | {nbsp}
| Max In Flight a| Number |  The maximum amount of messages that can be unacknowledged at a given time. Setting it to 0 means, there can be unlimited in-flight messages. |  10 | {nbsp}
| Clean Session a| Boolean |  If set to true, the session will be cleaned each time the client disconnects from the broker. Subscriptions will not be saved and offline (qos 1 and 2) messages for that client will be lost. |  true | {nbsp}
| Enable File Persistence a| Boolean |  If set to true, creates an file-based persistent data store, used to store outbound and inbound messages while they are in flight, enabling delivery to the QoS specified. |  false | {nbsp}
| Reconnection a| <<Reconnection>> |  When the application is deployed, a connectivity test is performed on all connectors. If set to true, deployment will fail if the test doesn't pass after exhausting the associated reconnection strategy |  | {nbsp}
|===
[[Config_Form]]
===== MQTT3 Form Connection


Cached Connection provider that creates MQTT Connections. Allows the user to specify a protocol, host and port to establish a connection with the broker.


====== Parameters

[%header%autowidth.spread]
|===
| Name | Type | Description | Default Value | Required
| Client ID a| String |  Client id to be used to identify the connection to the MQTT broker. |  | *x*{nbsp}
| Username a| String |  Username to be used when providing authentication credentials to the MQTT broker. |  | {nbsp}
| Password a| String |  Password to be used when providing authentication credentials to the MQTT broker. |  | {nbsp}
| Protocol a| Enumeration, one of:

** TCP
** WS
** WSS
** SSL
** LOCAL |  The transport level protocol to be used when connecting to the broker. Defaults to TCP |  TCP | {nbsp}
| URL a| String |  The host of the broker to connect to. |  | *x*{nbsp}
| Port a| String |  The broker's port to connect to. |  1883 | {nbsp}
| TLS Context a| <<Tls>> |  |  | {nbsp}
| Topic a| String |  The topic to which the last will and testament message will be published. |  | {nbsp}
| Body a| String |  The content of the last will and testament message. |  | {nbsp}
| QoS a| Enumeration, one of:

** AT_MOST_ONCE
** AT_LEAST_ONCE
** EXACTLY_ONCE |  The quality of service QoS with which the last will and testament message will be published. Defaults to AT_LEAST_ONCE |  AT_LEAST_ONCE | {nbsp}
| Is Retained a| Boolean |  If set to true the last will and testament message will be retained by the broker. |  false | {nbsp}
| Connection Timeout a| Number |  The socket connection timeout value. This attribute works in tandem with #timeoutUnit. In the case of multiple fail-over URLs provided, the timeout applies to each one individually. |  30 | {nbsp}
| Timeout Unit a| Enumeration, one of:

** NANOSECONDS
** MICROSECONDS
** MILLISECONDS
** SECONDS
** MINUTES
** HOURS
** DAYS |  A TimeUnit which qualifies the #connectionTimeout attribute. Defaults to SECONDS |  SECONDS | {nbsp}
| Keep Alive Interval a| Number |  The amount of time that the connection between client and broker will be kept alive without any messages being exchanged. If the keep-alive interval is 0, then the keep-alive mechanism is disabled. |  0 | {nbsp}
| Keep Alive Interval Unit a| Enumeration, one of:

** NANOSECONDS
** MICROSECONDS
** MILLISECONDS
** SECONDS
** MINUTES
** HOURS
** DAYS |  The unit of time that corresponds to the keepAliveInterval parameter. Defaults to SECONDS |  SECONDS | {nbsp}
| Max In Flight a| Number |  The maximum amount of messages that can be unacknowledged at a given time. Setting it to 0 means, there can be unlimited in-flight messages. |  10 | {nbsp}
| Clean Session a| Boolean |  If set to true, the session will be cleaned each time the client disconnects from the broker. Subscriptions will not be saved and offline (qos 1 and 2) messages for that client will be lost. |  true | {nbsp}
| Enable File Persistence a| Boolean |  If set to true, creates an file-based persistent data store, used to store outbound and inbound messages while they are in flight, enabling delivery to the QoS specified. |  false | {nbsp}
| Reconnection a| <<Reconnection>> |  When the application is deployed, a connectivity test is performed on all connectors. If set to true, deployment will fail if the test doesn't pass after exhausting the associated reconnection strategy |  | {nbsp}
|===

==== Associated Operations
* <<Publish>> {nbsp}

==== Associated Sources
* <<Listener>> {nbsp}


== Operations

[[Publish]]
== Publish
`<mqtt3:publish>`


Operation that allows the user to publish a single MQTT3Message to a given exchange


=== Parameters

[%header%autowidth.spread]
|===
| Name | Type | Description | Default Value | Required
| Configuration | String | The name of the configuration to use. | | *x*{nbsp}
| Topic a| String |  the topic to which the message must be published |  | *x*{nbsp}
| Message a| Any |  the content of the message to be published |  #[payload] | {nbsp}
| Qos a| Enumeration, one of:

** AT_MOST_ONCE
** AT_LEAST_ONCE
** EXACTLY_ONCE |  the QoS with which the message will be published |  AT_LEAST_ONCE | {nbsp}
| Is Retained a| Boolean |  whether the message should be retained by the broker |  false | {nbsp}
| Config Ref a| ConfigurationProvider |  The name of the configuration to be used to execute this component |  | *x*{nbsp}
| Reconnection Strategy a| * <<Reconnect>>
* <<ReconnectForever>> |  A retry strategy in case of connectivity errors |  | {nbsp}
|===


=== For Configurations

* <<Config>> {nbsp}

=== Throws

* MQTT3:CONNECTIVITY {nbsp}
* MQTT3:INVALID_TOPIC {nbsp}
* MQTT3:PERSISTENCE {nbsp}
* MQTT3:PUBLISH {nbsp}
* MQTT3:RETRY_EXHAUSTED {nbsp}
* MQTT3:WRITE_TIMEOUT {nbsp}


== Sources

[[Listener]]
== On New Message
`<mqtt3:listener>`


=== Parameters

[%header%autowidth.spread]
|===
| Name | Type | Description | Default Value | Required
| Configuration | String | The name of the configuration to use. | | *x*{nbsp}
| Topics a| Array of <<Topic>> |  The list of Topics that this listener will subscribe to. |  | *x*{nbsp}
| Config Ref a| ConfigurationProvider |  The name of the configuration to be used to execute this component |  | *x*{nbsp}
| Primary Node Only a| Boolean |  Whether this source should only be executed on the primary node when runnning in Cluster |  | {nbsp}
| Redelivery Policy a| <<RedeliveryPolicy>> |  Defines a policy for processing the redelivery of the same message |  | {nbsp}
| Reconnection Strategy a| * <<Reconnect>>
* <<ReconnectForever>> |  A retry strategy in case of connectivity errors |  | {nbsp}
|===

=== Output

[%autowidth.spread]
|===
| *Type* a| Any
| *Attributes Type* a| <<Mqtt3MessageAttributes>>
|===

=== For Configurations

* <<Config>> {nbsp}



== Types
[[Tls]]
=== Tls

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Enabled Protocols a| String | A comma separated list of protocols enabled for this context. |  |
| Enabled Cipher Suites a| String | A comma separated list of cipher suites enabled for this context. |  |
| Trust Store a| <<TrustStore>> |  |  |
| Key Store a| <<KeyStore>> |  |  |
| Revocation Check a| * <<StandardRevocationCheck>>
* <<CustomOcspResponder>>
* <<CrlFile>> |  |  |
|======================

[[TrustStore]]
=== Trust Store

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Path a| String | The location (which will be resolved relative to the current classpath and file system, if possible) of the trust store. |  |
| Password a| String | The password used to protect the trust store. |  |
| Type a| String | The type of store used. |  |
| Algorithm a| String | The algorithm used by the trust store. |  |
| Insecure a| Boolean | If true, no certificate validations will be performed, rendering connections vulnerable to attacks. Use at your own risk. |  |
|======================

[[KeyStore]]
=== Key Store

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Path a| String | The location (which will be resolved relative to the current classpath and file system, if possible) of the key store. |  |
| Type a| String | The type of store used. |  |
| Alias a| String | When the key store contains many private keys, this attribute indicates the alias of the key that should be used. If not defined, the first key in the file will be used by default. |  |
| Key Password a| String | The password used to protect the private key. |  |
| Password a| String | The password used to protect the key store. |  |
| Algorithm a| String | The algorithm used by the key store. |  |
|======================

[[StandardRevocationCheck]]
=== Standard Revocation Check

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Only End Entities a| Boolean | Only verify the last element of the certificate chain. |  |
| Prefer Crls a| Boolean | Try CRL instead of OCSP first. |  |
| No Fallback a| Boolean | Do not use the secondary checking method (the one not selected before). |  |
| Soft Fail a| Boolean | Avoid verification failure when the revocation server can not be reached or is busy. |  |
|======================

[[CustomOcspResponder]]
=== Custom Ocsp Responder

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Url a| String | The URL of the OCSP responder. |  |
| Cert Alias a| String | Alias of the signing certificate for the OCSP response (must be in the trust store), if present. |  |
|======================

[[CrlFile]]
=== Crl File

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Path a| String | The path to the CRL file. |  |
|======================

[[Reconnection]]
=== Reconnection

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Fails Deployment a| Boolean | When the application is deployed, a connectivity test is performed on all connectors. If set to true, deployment will fail if the test doesn't pass after exhausting the associated reconnection strategy |  |
| Reconnection Strategy a| * <<Reconnect>>
* <<ReconnectForever>> | The reconnection strategy to use |  |
|======================

[[Reconnect]]
=== Reconnect

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Frequency a| Number | How often (in ms) to reconnect |  |
| Blocking a| Boolean | If false, the reconnection strategy will run in a separate, non-blocking thread |  |
| Count a| Number | How many reconnection attempts to make |  |
|======================

[[ReconnectForever]]
=== Reconnect Forever

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Frequency a| Number | How often (in ms) to reconnect |  |
| Blocking a| Boolean | If false, the reconnection strategy will run in a separate, non-blocking thread |  |
|======================

[[FailOverUrl]]
=== Fail Over URL

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Protocol a| Enumeration, one of:

** TCP
** WS
** WSS
** SSL
** LOCAL | The transport level protocol to be used when connecting to the broker. | TCP |
| Host a| String | The host of the broker to connect to. | localhost |
| Port a| String | The broker's port to connect to. | 1883 |
|======================

[[ExpirationPolicy]]
=== Expiration Policy

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Max Idle Time a| Number | A scalar time value for the maximum amount of time a dynamic configuration instance should be allowed to be idle before it's considered eligible for expiration |  |
| Time Unit a| Enumeration, one of:

** NANOSECONDS
** MICROSECONDS
** MILLISECONDS
** SECONDS
** MINUTES
** HOURS
** DAYS | A time unit that qualifies the maxIdleTime attribute |  |
|======================

[[Mqtt3MessageAttributes]]
=== MQTT3 Message Attributes

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Topic a| String | The topic to which the broker directed the message. |  | x
| Message Id a| Number | The MQTT id that identifies a message received from the broker. |  | x
| Qos a| Number | The quality of service with which the message was delivered by the broker. |  | x
| Is Duplicate a| Boolean | If set to true, this message might be a duplicate of one which has already been received. | false |
| Is Retained a| Boolean | If set to true, this message was either sent from a current publisher, or was "retained" by the server
 as the last message published on the topic. | false |
|======================

[[Topic]]
=== Topic

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Topic Filter a| String | A topic filter that can represent a single or multilevel subscription to a topic. |  | x
| Qos a| Enumeration, one of:

** AT_MOST_ONCE
** AT_LEAST_ONCE
** EXACTLY_ONCE | The QoS with which messages (destined to this topic's topicFilter)
 should be sent by the broker.
 <p>
 Defaults to AT_LEAST_ONCE | AT_LEAST_ONCE |
|======================

[[RedeliveryPolicy]]
=== Redelivery Policy

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Max Redelivery Count a| Number | The maximum number of times a message can be redelivered and processed unsuccessfully before triggering process-failed-message |  |
| Message Digest Algorithm a| String | The secure hashing algorithm to use. If not set, the default is SHA-256. |  |
| Message Identifier a| <<RedeliveryPolicyMessageIdentifier>> | Defines which strategy is used to identify the messages. |  |
| Object Store a| ObjectStore | The object store where the redelivery counter for each message is going to be stored. |  |
|======================

[[RedeliveryPolicyMessageIdentifier]]
=== Redelivery Policy Message Identifier

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Use Secure Hash a| Boolean | Whether to use a secure hash algorithm to identify a redelivered message |  |
| Id Expression a| String | Defines one or more expressions to use to determine when a message has been redelivered. This property may only be set if useSecureHash is false. |  |
|======================

