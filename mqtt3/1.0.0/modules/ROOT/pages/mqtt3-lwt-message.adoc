= Set Last Will And Testament Messages
:page-aliases: connectors::mqtt3/mqtt3-lwt-message.adoc

By setting a last will and testament message we ensure that in the event that the client should be abnormally (temporarily or permanently)
disconnected from the broker, a message will be sent to a specific lwt topic, notifying all its subscribers of that clientâ€™s disconnection.
The lwt message is set at the time the connection to the broker is established.

The last will and testament message must therefore be set in the configuration element and you can specify whether you
want the broker to retain that message or not. If an mqtt message is set for retention, the broker will store the last message
marked as retained that arrived to a specific topic. If no listeners are subscribed to a matching topic at the time the message is sent,
the broker will store the message until a listener connects to that topic. Then the broker will deliver the listener the last
message retained for that topic.

[source,xml,linenums]
----
<mqtt3:config name="MQTT_LWT_Config">
    <mqtt3:connection clientId="azfell-and-co-123" username="aziraphale" password="principality" url="tcp://127.0.0.1:1883">
        <mqtt3:last-will-and-testament topic="LWT" body="The end is nye" isRetained="true"/>
    </mqtt3:connection>
</mqtt3:config>
----

